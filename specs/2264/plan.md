# Plan #2264

Status: Reviewed
Spec: specs/2264/spec.md

## Approach

1. Add Homebrew formula rendering tooling:
   - parse `SHA256SUMS` generated by release automation
   - render deterministic `tau.rb` with Linux/macOS amd64/arm64 blocks
   - include `bin.install "tau-coding-agent" => "tau"` and `test do` smoke.
2. Add contract validation scripts:
   - RED/GREEN script that validates formula structure and checksum mapping.
3. Wire release workflow:
   - generate formula after checksums are produced
   - upload formula as release asset with deterministic naming.
4. Update operator docs:
   - README and release guide include install/upgrade/uninstall commands and
     formula artifact location.

## Affected Modules

- `scripts/release/*` (formula renderer + validation script)
- `.github/workflows/release.yml`
- `scripts/release/test-release-workflow-contract.sh`
- `README.md`
- `docs/guides/release-automation-ops.md`
- `specs/2264/*`

## Risks and Mitigations

- Risk: formula URL/checksum mapping drifts from release asset names.
  - Mitigation: generate directly from release `SHA256SUMS`; enforce via
    contract test against known fixture.
- Risk: Homebrew audit/test contract misses runtime binary naming mismatch.
  - Mitigation: assert install alias (`tau`) and smoke `test do` in scripted
    contract checks.
- Risk: release workflow adds steps but does not publish formula asset.
  - Mitigation: extend release workflow contract test with required step checks.

## Interfaces / Contracts

- No runtime API behavior changes.
- New delivery contract:
  - `scripts/release/render-homebrew-formula.sh <tag> <sha256sums-path>` outputs
    deterministic formula content.
  - Release workflow publishes generated formula as a first-party release asset.
